{"remainingRequest":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\src\\components\\admin\\Users.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\src\\components\\admin\\Users.vue","mtime":1628309540000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7bWFwU3RhdGV9IGZyb20gJ3Z1ZXgnCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdXNlckxpc3Q6IFtdLAogICAgICAgICAgICBzZWFyY2g6ICcnCiAgICAgICAgfQogICAgfSwKICAgIGNvbXB1dGVkOnsKICAgICAgICAuLi5tYXBTdGF0ZShbCiAgICAgICAgICAgICd1c2VySW5mbycsCiAgICAgICAgXSkKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMuZ2V0VXNlckxpc3QoKQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBhc3luYyBnZXRVc2VyTGlzdCgpIHsKICAgICAgICAgICAgY29uc3Qge2RhdGE6IHJlc30gPSBhd2FpdCB0aGlzLiRibG9nLmdldCgndXNlcnMnKTsKICAgICAgICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDApIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaCAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgc3QgPSB0aGlzLnNlYXJjaAogICAgICAgICAgICAgICAgICAgIGxldCByZWcgPSBSZWdFeHAoc3QpCiAgICAgICAgICAgICAgICAgICAgcmVzLmRhdGEgPSByZXMuZGF0YS5maWx0ZXIoKGl0ZW0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZy50ZXN0KGl0ZW0ubmlja25hbWUpIHx8IHJlZy50ZXN0KGl0ZW0udXNlcm5hbWUpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudXNlckxpc3QgPSByZXMuZGF0YQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi6I635Y+W55So5oi35L+h5oGv5aSx6LSl77yBIikKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2VhcmNoVXNlcigpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5zZWFyY2gpCiAgICAgICAgICAgIHRoaXMuZ2V0VXNlckxpc3QoKQogICAgICAgIH0sCiAgICAgICAgLy8g5L+u5pS555So5oi35p2D6ZmQCiAgICAgICAgYXN5bmMgdXNlclN0YXRlQ2hhbmdlZChyb3cpIHsKICAgICAgICAgICAgY29uc3Qge2RhdGE6IHJlc30gPSBhd2FpdCB0aGlzLiRibG9nLnBvc3QoJy9hZG1pbi91c2VyJywgewogICAgICAgICAgICAgICAgdXNlcjogcm93CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAocmVzLmNvZGUgIT09IDIwMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuS/ruaUueadg+mZkOWksei0pSIpCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5L+u5pS55p2D6ZmQ5oiQ5YqfIikKCiAgICAgICAgfSwKICAgICAgICAvLyDliKDpmaTnlKjmiLcKICAgICAgICBhc3luYyBkZWxldGVVc2VyKGlkKSB7CiAgICAgICAgICAgIC8vIOW8ueWHuuWvueivneahhgogICAgICAgICAgICBjb25zdCBjb25maXJtUmVzdWx0ID0gYXdhaXQgdGhpcy4kY29uZmlybSgKICAgICAgICAgICAgICAgICfmraTmk43kvZzlsIbmsLjkuYXliKDpmaTor6XnlKjmiLcsIOaYr+WQpue7p+e7rScsCiAgICAgICAgICAgICAgICAn5o+Q56S6JywKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkuY2F0Y2goZXJyID0+IGVycikKICAgICAgICAgICAgaWYgKGNvbmZpcm1SZXN1bHQgIT09ICdjb25maXJtJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuaW5mbygn5bey5Y+W5raI5Yig6ZmkJykKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB7ZGF0YTogcmVzfSA9IGF3YWl0IHRoaXMuJGJsb2cuZ2V0KGAvYWRtaW4vdXNlcnMvJHtpZH0vZGVsZXRlYCkKICAgICAgICAgICAgaWYgKHJlcy5jb2RlICE9PSAyMDApIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfliKDpmaTnlKjmiLflpLHotKXvvIEnKQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WIoOmZpOeUqOaIt+aIkOWKn++8gScpCiAgICAgICAgICAgIHRoaXMuZ2V0VXNlckxpc3QoKQogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["Users.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Users.vue","sourceRoot":"src/components/admin","sourcesContent":["<template>\n    <div>\n        <el-card shadow=\"never\">\n            <el-row :gutter=\"5\">\n                <el-col :span=\"8\">\n                    <el-input placeholder=\"请输入用户名或用户昵称\" v-model=\"search\"></el-input>\n                </el-col>\n                <el-col :span=\"3\">\n                    <el-button type=\"primary\" @click=\"searchUser()\">查找用户</el-button>\n                </el-col>\n            </el-row>\n            <el-table :data=\"userList\">\n                <el-table-column type=\"index\"></el-table-column>\n                <el-table-column label=\"头像\" prop=\"avatar\" min-width=\"60px\">\n                    <template slot-scope=\"scope\">\n                        <el-avatar :src=\"scope.row.avatar\"></el-avatar>\n                    </template>\n                </el-table-column>\n                <el-table-column label=\"昵称\" prop=\"nickname\"></el-table-column>\n                <el-table-column label=\"账号\" prop=\"username\"></el-table-column>\n                <el-table-column label=\"邮箱\" prop=\"email\" min-width=\"100px\"></el-table-column>\n                <el-table-column label=\"注册时间\" prop=\"createTime\" min-width=\"100px\">\n                    <template slot-scope=\"scope\">{{scope.row.createTime | dataFormat }}</template>\n                </el-table-column>\n                <el-table-column label=\"最近登录\" prop=\"loginTime\">\n                    <template slot-scope=\"scope\">{{scope.row.lastLoginTime===null?scope.row.createTime:scope.row.lastLoginTime | dataFormat3 }}</template>\n                </el-table-column>\n                <el-table-column label=\"地址\">\n                    <template slot-scope=\"scope\">{{scope.row.loginProvince +' '+ scope.row.loginCity }}</template>\n                </el-table-column>\n                <el-table-column label=\"管理员\" min-width=\"70px\">\n                    <template slot-scope=\"scope\">\n                        <el-switch active-value=\"1\" inactive-value=\"0\" v-model=\"scope.row.type\" :disabled=\"userInfo.id== scope.row.id || scope.row.id == 1\"\n                                   @change=\"userStateChanged(scope.row)\">\n                        </el-switch>\n                    </template>\n                </el-table-column>\n                <el-table-column label=\"操作\" width=\"60px\">\n                    <template slot-scope=\"scope\">\n                        <el-button size=\"mini\" circle type=\"danger\" icon=\"el-icon-delete\"\n                                   @click=\"deleteUser(scope.row.id)\"></el-button>\n                    </template>\n                </el-table-column>\n            </el-table>\n        </el-card>\n    </div>\n\n</template>\n\n<script>\nimport {mapState} from 'vuex'\nexport default {\n    data() {\n        return {\n            userList: [],\n            search: ''\n        }\n    },\n    computed:{\n        ...mapState([\n            'userInfo',\n        ])\n    },\n    created() {\n        this.getUserList()\n    },\n    methods: {\n        async getUserList() {\n            const {data: res} = await this.$blog.get('users');\n            if (res.code === 200) {\n                if (this.search !== '') {\n                    let st = this.search\n                    let reg = RegExp(st)\n                    res.data = res.data.filter((item) => {\n                        return reg.test(item.nickname) || reg.test(item.username)\n                    })\n                }\n                this.userList = res.data\n            } else {\n                this.$message.error(\"获取用户信息失败！\")\n            }\n        },\n        searchUser() {\n            // console.log(this.search)\n            this.getUserList()\n        },\n        // 修改用户权限\n        async userStateChanged(row) {\n            const {data: res} = await this.$blog.post('/admin/user', {\n                user: row\n            });\n            if (res.code !== 200) return this.$message.error(\"修改权限失败\")\n            this.$message.success(\"修改权限成功\")\n\n        },\n        // 删除用户\n        async deleteUser(id) {\n            // 弹出对话框\n            const confirmResult = await this.$confirm(\n                '此操作将永久删除该用户, 是否继续',\n                '提示',\n                {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }\n            ).catch(err => err)\n            if (confirmResult !== 'confirm') {\n                return this.$message.info('已取消删除')\n            }\n            const {data: res} = await this.$blog.get(`/admin/users/${id}/delete`)\n            if (res.code !== 200) return this.$message.error('删除用户失败！')\n            this.$message.success('删除用户成功！')\n            this.getUserList()\n        }\n    }\n}\n</script>\n\n<style scoped lang=\"less\">\n\n</style>\n"]}]}