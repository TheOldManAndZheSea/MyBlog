{"remainingRequest":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\src\\components\\login\\Login.vue?vue&type=style&index=0&id=4a69470a&lang=less&scoped=true&","dependencies":[{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\src\\components\\login\\Login.vue","mtime":1628309540000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\文档\\张天赐\\练习代码\\VSCode\\个人博客\\前台\\myblog-frontend-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubG9naW5fZm9ybSB7CiAgICB3aWR0aDogMTAwJTsKICAgIHBhZGRpbmc6IDAgMjBweDsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7Cn0KCi5idG5zIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOwp9CgoubG9naW5fZGlhbG9newogICAgb3BhY2l0eTogMTsKfQoK"},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Login.vue","sourceRoot":"src/components/login","sourcesContent":["<template>\n    <el-dialog class=\"login_dialog\" title=\"请登录\" :visible.sync=\"loginFormVisiable\" @close=\"resetLoginForm\" width=\"400px\" center>\n        <el-form ref=\"loginFormRef\" :model=\"loginForm\" :rules=\"loginFormRules\" label-width=\"60px\" class=\"login_form\">\n            <!--        用户名-->\n            <el-form-item prop=\"username\" label=\"账号\">\n                <el-input v-model=\"loginForm.username\">\n                </el-input>\n            </el-form-item>\n            <!--        密码-->\n            <el-form-item prop=\"password\" label=\"密码\">\n                <el-input type=\"password\" v-model=\"loginForm.password\"></el-input>\n            </el-form-item>\n            <el-form-item style=\"text-align: right\">\n                <el-button @click=\"resetLoginForm\">取消</el-button>\n                <el-button type=\"primary\" @click=\"userLogin\">登录</el-button>\n            </el-form-item>\n        </el-form>\n    </el-dialog>\n</template>\n\n<script>\nimport {mapState} from 'vuex'\n\nexport default {\n    data() {\n        return {\n            user:{\n                username:'',\n                password:'',\n                loginProvince:'陕西省',\n                loginCity:'咸阳市',\n                loginLat:34.27, //纬度\n                loginLng:108.08, //经度\n            },\n            // 表单数据绑定对象\n            loginForm: {\n                username: '',\n                password: ''\n            },\n            // 表单验证规则对象\n            loginFormRules: {\n                // 验证用户是否合法\n                username: [\n                    // 必填，提示消息，鼠标焦点消失时触发\n                    {required: true, message: \"请输入用户名\", trigger: \"blur\"},\n                    {min: 2, max: 10, message: \"长度在2-10个字符之间\"}\n                ],\n                // 验证密码是否合法\n                password: [\n                    {required: true, message: \"请输入密码\", trigger: \"blur\"},\n                    {min: 6, max: 10, message: \"长度在 6 到 10 个字符\", trigger: \"blur\"}\n                ]\n            },\n        }\n    },\n    computed:{\n       ...mapState([\n           'loginFormVisiable'\n       ])\n    },\n    methods: {\n        resetLoginForm() {\n            this.$store.commit('cancelLFV')\n            this.$refs.loginFormRef.resetFields()\n        },\n        // 用户登录\n        userLogin() {\n            this.$refs.loginFormRef.validate(async valid => {\n                if (!valid) return;\n                this.user.username = this.loginForm.username\n                this.user.password = this.$md5(this.loginForm.password)\n                let local = await this.getLocalCity()\n                this.user.loginProvince = local.result.ad_info.province\n                this.user.loginCity = local.result.ad_info.city\n                this.user.loginLat = local.result.location.lat\n                this.user.loginLng = local.result.location.lng\n                const {data: res} = await this.$blog.post('/login', {\n                    user:this.user\n                });\n                if (res.code !== 200) return this.$message({message: '用户名或密码错误', type: 'error', offset: 80})\n                this.$message({message: '登录成功', type: 'success', offset: 80});\n                this.$refs.loginFormRef.resetFields()\n                window.sessionStorage.setItem(\"token\", JSON.stringify(res.data.token));\n                window.sessionStorage.setItem(\"user\", JSON.stringify(res.data.user));\n                this.$store.commit('getUserInfo')\n                this.$store.commit('cancelLFV')\n            })\n        },\n        async getLocalCity(){\n            let data = {\n                key: 'IUTBZ-UHAKU-PD6VI-BZEEY-N3YT3-SCB6J',\n                output:'jsonp'\n            }\n            let url = 'https://apis.map.qq.com/ws/location/v1/ip'\n            // console.log(this.$jsonp(url, data))\n            const res = await this.$jsonp(url, data)\n            return res\n        }\n    }\n}\n</script>\n\n<style lang=\"less\" scoped>\n\n    .login_form {\n        width: 100%;\n        padding: 0 20px;\n        box-sizing: border-box;\n    }\n\n    .btns {\n        display: flex;\n        justify-content: flex-end;\n    }\n\n    .login_dialog{\n        opacity: 1;\n    }\n\n</style>\n"]}]}